# 🤖 AI 학습용 노하우 구조화 도구

물류 반송 분석을 위한 전문가 노하우를 구조화하여 AI에게 학습시킬 수 있는 도구입니다.

## 📋 목차

- [기능 소개](#기능-소개)
- [설치 방법](#설치-방법)
- [사용 방법](#사용-방법)
- [노드 타입 설명](#노드-타입-설명)
- [JSON 내보내기](#json-내보내기)

## 🎯 기능 소개

이 도구는 전문가의 **암묵지(Tacit Knowledge)**를 **형식지(Explicit Knowledge)**로 변환하여 AI에게 학습시킬 수 있는 구조화된 데이터를 생성합니다.

### 핵심 기능

1. **노드 기반 워크플로우 작성**: 드래그 앤 드롭으로 직관적인 로직 구성
2. **파일 첨부 & 공유**: 노드별 캡처/문서 등을 첨부하고 `.flow` 파일 하나로 공유
3. **5가지 노드 타입**: 상황, 정보수집, 판단, 반복, 결론
4. **AI 학습용 워크플로우 저장**: 구조화된 데이터를 `.flow`(ZIP) 또는 JSON 형식으로 저장

## 📦 설치 방법

### 1. 필요한 패키지 설치

```bash
pip install -r requirements.txt
```

### 2. 프로그램 실행

```bash
python main.py
```

### 3. EXE 파일 빌드 (선택사항)

독립 실행 파일(.exe)을 만들려면:

**방법 1: 배치 파일 사용 (권장)**
```bash
build_exe.bat
```

**방법 2: PyInstaller 직접 사용**
```bash
pip install pyinstaller
pyinstaller --name="SDC_LogicCanvas" --onefile --windowed --icon=icon.png main.py
```

**중요: EXE 파일 사용 시**

빌드된 EXE 파일과 **같은 폴더**에 다음 JSON 파일들을 복사하세요:
- `tables.json` - 테이블 목록
- `situation_types.json` - 상황 유형 목록
- `screens.json` - 화면 목록
- `logs.json` - 로그 목록

이 파일들은 사용자가 직접 수정할 수 있으며, 프로그램 실행 시 자동으로 로드됩니다.  
EXE 파일을 다른 위치로 이동할 때는 이 JSON 파일들도 함께 이동해야 합니다.

> **참고**: EXE 빌드 시 JSON 파일들은 EXE 내부에 포함되지 않습니다. 이는 사용자가 직접 수정할 수 있도록 하기 위함입니다.

## 🎮 사용 방법

### 노드 추가하기

**방법 1: 그래프 영역 우클릭**
1. 그래프 영역(회색 배경)에서 **우클릭**
2. 나타나는 메뉴에서 원하는 노드 타입 선택:
   - `상황 (Trigger)` - 분석 시작점
   - `정보 수집 (Data Gathering)` - 데이터 조회
   - `판단 (Decision)` - 조건 분기
   - `반복 (Loop)` - 반복 처리
   - `결론 (Conclusion)` - 최종 결론

**방법 2: 기존 노드에서 연결**
- 노드의 출력 포트(오른쪽)에서 드래그하여 새 노드 생성

### 노드 연결하기

1. 노드의 **출력 포트**(오른쪽 초록색/주황색 원)를 클릭
2. 다른 노드의 **입력 포트**(왼쪽 초록색/주황색 원)로 드래그
3. 연결선이 생성되면 연결 완료!

### 노드 속성 편집하기

1. 노드를 **클릭**하여 선택
2. 우측 **속성 (Properties)** 패널에서 편집:
   - 텍스트 입력: 상황 설명, 판단 조건 등
   - 드롭다운: 테이블 선택, 컬럼 선택 등

### 노드 이동하기

- 노드를 **드래그**하여 원하는 위치로 이동

### 노드 삭제하기

- 노드를 선택하고 **Delete** 키 또는 **우클릭 > 삭제**

### 파일 첨부하기

1. 좌측 상단 `📎 파일 첨부` 패널에서 **노드를 선택**합니다.  
2. `📁 파일 선택` 버튼을 눌러 이미지·문서 등 원하는 파일을 고릅니다.  
3. 첨부가 완료되면 `첨부된 파일` 라벨에 파일명이 표시되고, `📂 파일 열기` 버튼으로 즉시 열 수 있습니다.  
4. `🗑️ 파일 삭제` 버튼으로 연결을 제거하면 `.flow` 저장 시에도 포함되지 않습니다.  

> 첨부된 파일은 자동으로 임시 폴더에 복사되며, 워크플로우를 저장할 때 `.flow` 파일 내부 `attachments/` 폴더에 함께 압축됩니다.

## 📊 노드 타입 설명

### 1. 상황 노드 (Trigger) 🟢
- **역할**: 분석을 시작하는 출발점
- **AI 학습 포인트**: "이런 문제가 발생했을 때 분석을 시작해라"
- **속성**:
  - 상황 설명: 문제 상황을 설명
  - 상황 유형: 반송 지연, 설비 오류 등

### 2. 정보 수집 노드 (Data Gathering) 🔵
- **역할**: 필요한 데이터를 조회
- **AI 학습 포인트**: "문제를 풀려면 이 데이터를 먼저 찾아봐야 해"
- **속성**:
  - 대상 테이블: TB_MCS_LOG, TB_WMS_STOCK 등
  - 확인 컬럼: Error_Code, Transport_ID 등
  - AI 지시사항: 왜 이 데이터를 봐야 하는지 설명

### 3. 판단 노드 (Decision) 🔴
- **역할**: 조건에 따라 분기 처리
- **AI 학습 포인트**: Chain of Thought (생각의 사슬) 핵심
- **속성**:
  - 판단 조건: `error_code == "JAM"`, `battery_level < 20` 등
  - 판단 근거: 왜 이렇게 판단하는지 설명
- **출력**: True (참) / False (거짓) 두 가지 분기

### 4. 반복 노드 (Loop) 🟣
- **역할**: 리스트 전체를 반복 처리
- **AI 학습 포인트**: "하나만 보지 말고, 리스트 전체를 훑어서 패턴을 찾아"
- **속성**:
  - 반복 대상: `failed_transport_jobs`, `해당 시간대의 모든 반송 명령` 등
  - AI 지시사항: 반복 처리 방법 설명

### 5. 결론 노드 (Conclusion) 🟠
- **역할**: 최종 결론 정리
- **AI 학습 포인트**: 최종 결론을 명확하게 정리
- **속성**:
  - 결론 내용: 분석 결과 요약
  - 결론 유형: 원인 파악, 조치 사항, 예방 방안 등

## 💾 워크플로우 저장 / 불러오기

### 저장 (기본: `.flow`)

### 방법 1: 툴바 버튼 사용 (권장)

1. 상단 툴바에서 **💾 JSON 내보내기** 버튼 클릭  
2. 저장할 파일명을 입력합니다. 확장자를 비워두면 자동으로 `.flow`가 붙습니다.  
3. 저장하면 `workflow.json` + `attachments/` 폴더가 하나의 `.flow` 파일로 묶입니다.

### 방법 2: 메뉴 사용

1. 메뉴바에서 **파일 (File) > 파일 저장** 선택  
2. 저장할 파일명 입력
3. 저장 완료!

> `.flow` 파일은 ZIP과 동일한 구조라서 필요하면 확장자를 `.zip`으로 바꿔 내부를 확인할 수 있습니다.

### JSON Export (위치 정보 제외)

위치 정보 없이 순수 JSON 형식으로 내보내려면:

1. 메뉴바에서 **파일 (File) > Export > JSON Export** 선택
2. 저장할 파일명 입력 (예: `workflow_export.json`)
3. 노드 위치 정보(`position`, `node_id`)가 제외된 순수 워크플로우 데이터만 저장됩니다.

> 이 기능은 AI 학습용 데이터를 생성할 때 유용합니다. 노드의 화면상 위치 정보는 제외하고 워크플로우 로직만 추출합니다.

### 불러오기

1. **파일 (File) > 파일 열기**에서 `.flow`, `.zip`, `.json` 중 원하는 파일을 선택합니다.  
2. `.flow`/`.zip`을 선택하면 내부 `workflow.json`을 읽고, `attachments/` 폴더를 임시 디렉터리에 복원합니다.  
3. 불러오기가 끝나면 `📎 파일 첨부` 패널에 선택한 노드의 첨부 파일이 즉시 표시됩니다.
4. **자동 항목 추가**: 워크플로우에서 사용된 테이블, 화면, 로그, 상황 유형이 자동으로 "항목 관리" 패널의 각 탭에 추가되고, 기존 노드의 드롭다운 메뉴에도 즉시 반영됩니다.

### JSON 파일 구조

내보낸 JSON 파일은 다음과 같은 구조를 가집니다:

```json
{
  "workflow_name": "물류_반송_분석_가이드",
  "description": "전문가 노하우를 구조화한 AI 학습용 워크플로우",
  "steps": [
    {
      "id": 1,
      "name": "상황: 반송 지연",
      "type": "trigger",
      "situation": "반송 명령 후 10분 지연",
      "instruction": "상황: 반송 명령 후 10분 지연 - 이 상황이 발생했을 때 분석을 시작하세요."
    },
    {
      "id": 2,
      "name": "OHT 상태 조회",
      "type": "observation",
      "table": "TB_OHT_STATUS",
      "column": "Battery_Level",
      "instruction": "OHT 상태 로그에서 배터리 잔량을 확인해"
    },
    {
      "id": 3,
      "name": "배터리 체크",
      "type": "reasoning",
      "condition": "battery_level < 20",
      "reasoning": "배터리가 20% 이하면 충전 대기 상태일 수 있음",
      "instruction": "조건: battery_level < 20 - 배터리가 20% 이하면 충전 대기 상태일 수 있음"
    }
  ]
}
```

이 JSON 파일을 AI 학습 데이터로 사용할 수 있습니다!

## 🎓 예시 시나리오

프로그램을 실행하면 **반송 지연 분석** 예시 워크플로우가 자동으로 생성됩니다:

1. **상황**: 반송 명령 후 10분 지연
2. **반복**: 해당 라인의 모든 OHT 차량에 대해 검사
3. **정보 수집**: OHT 상태 로그에서 배터리 잔량 확인
4. **판단**: 배터리가 20% 이하인가?
   - **True**: 충전 대기로 인한 지연 (결론)
   - **False**: 센서 감지 이력 확인 → 추가 분석

## 💡 팁

- **노드 이름 변경**: 노드를 더블클릭하거나 속성 패널에서 이름 변경
- **노드 복사**: 노드 선택 후 Ctrl+C, Ctrl+V
- **전체 선택**: Ctrl+A
- **되돌리기/다시하기**: Ctrl+Z, Ctrl+Y
- **확대/축소**: 마우스 휠 또는 Ctrl + 마우스 휠
- **파일 첨부**: 노드를 선택하고 좌측 `📎 파일 첨부` 패널에서 `📁 파일 선택`
- **패널 리셋**: 패널을 닫았거나 위치를 변경했을 때, **보기 (View) > 패널 리셋**으로 기본 레이아웃 복원
- **프로그램 정보**: **도움말 (Help) > 프로그램 정보**에서 버전, 개발자 정보 확인
- **자동 항목 추가**: `.flow` 파일을 열면 사용된 테이블, 화면, 로그, 상황 유형이 자동으로 "항목 관리" 패널에 추가됩니다

## 🐛 문제 해결

### 노드가 보이지 않아요
- 그래프 영역을 우클릭하여 노드 메뉴 확인
- 노드가 화면 밖에 있을 수 있으니 확대/축소로 확인

### JSON 내보내기가 안 돼요
- 툴바 버튼이 보이지 않으면, Python 코드에서 직접 호출:
  ```python
  export_to_json(graph, 'my_workflow.json')
  ```

### 프로그램이 실행되지 않아요
- NumPy 버전 문제일 수 있습니다:
  ```bash
  pip install "numpy<2.0.0"
  ```


---

**버전**: 1.0.0  
**최종 업데이트**: 2025

